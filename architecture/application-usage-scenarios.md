## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ email

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as External API Gateway
    participant U as –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    participant DB as PostgreSQL
    participant E as Event Bus

    M->>A: POST /register (email, password)
    A->>U: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    U->>DB: INSERT INTO users
    DB-->>U: –£—Å–ø–µ—Ö
    U->>E: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è UserRegistered
    E-->>M: –û—Ç–≤–µ—Ç "—É—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ email –∏ –ø–∞—Ä–æ–ª—å. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `UserRegistered`, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å welcome-–Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as External API Gateway
    participant U as –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    participant DB as PostgreSQL
    participant S as OAuth Provider
    participant E as Event Bus

    M->>S: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google/Facebook
    S-->>M: –¢–æ–∫–µ–Ω
    M->>A: POST /social-login
    A->>U: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    U->>S: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    S-->>U: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    U->>DB: –ü–æ–∏—Å–∫ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    DB-->>U: –†–µ–∑—É–ª—å—Ç–∞—Ç
    U->>E: –ü—É–±–ª–∏–∫–∞—Ü–∏—è UserLoggedIn
    E-->>M: –¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ —Å–æ—Ü—Å–µ—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ OAuth. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `UserLoggedIn`.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–ø–∏—Å—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–≤ online-—Ä–µ–∂–∏–º–µ)

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant W as –°–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    participant DB as PostgreSQL
    participant E as Event Bus

    M->>A: POST /workouts/start
    A->>W: –ó–∞–ø—Ä–æ—Å –Ω–∞ –Ω–∞—á–∞–ª–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    W->>DB: INSERT INTO workouts
    DB-->>W: ID —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    W->>E: WorkoutStarted
    E-->>M: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –º–∞—Ä—à—Ä—É—Ç–µ –∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ö –¥–∞—Ç—á–∏–∫–æ–≤ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ–∑–∂–µ.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å GPS

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant W as –°–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    participant DB as PostgreSQL
    participant E as Event Bus
    participant AI as AI Engine

    M->>A: PUT /workouts/{id}
    A->>W: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    W->>DB: UPDATE workouts SET ...
    W->>E: WorkoutCompleted
    E->>AI: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    DB-->>W: –£—Å–ø–µ—Ö
    E-->>M: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–∞—Ä—à—Ä—É—Ç, –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤). –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant R as –°–µ—Ä–≤–∏—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    participant C as Redis Cache
    participant AI as AI Engine

    M->>A: GET /recommendations
    A->>R: –ó–∞–ø—Ä–æ—Å
    R->>C: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    alt –ï—Å—Ç—å –≤ –∫—ç—à–µ
        C-->>R: –î–∞–Ω–Ω—ã–µ
    else –ù–µ—Ç –≤ –∫—ç—à–µ
        R->>AI: –ó–∞–ø—Ä–æ—Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
        AI-->>R: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        R->>C: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
    end
    R-->>M: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞ –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ AI-–¥–≤–∏–∂–æ–∫.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 6: –û—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –¥—Ä—É–≥–∞

```mermaid
sequenceDiagram
    participant E as Event Bus
    participant AI as AI Engine
    participant N as –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    participant P as Push Provider
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

    E->>N: AchievementUnlocked
    N->>P: –û—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    P-->>M: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–°–æ–±—ã—Ç–∏–µ `AchievementUnlocked` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å—Å—ã–ª–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ push-—Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–∑—å—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 7: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant AN as –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    participant CH as ClickHouse
    participant C as Redis

    M->>A: GET /leaderboard
    A->>AN: –ó–∞–ø—Ä–æ—Å
    AN->>CH: SELECT * FROM leaderboard
    CH-->>AN: –†–µ–π—Ç–∏–Ω–≥
    AN->>C: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    AN-->>M: –õ–∏–¥–µ—Ä–±–æ—Ä–¥
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ –∫–æ–ª–æ–Ω–æ—á–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (ClickHouse) –∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 8: –ê/–í —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –ø—Ä–æ–º–æ–∞–∫—Ü–∏–∏

```mermaid
sequenceDiagram
    participant MK as –°–µ—Ä–≤–∏—Å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    participant DB as ClickHouse
    participant A as AI Engine
    participant UI as –í–µ–±-–∞–¥–º–∏–Ω–∫–∞

    MK->>DB: SELECT metrics
    DB-->>MK: –°–æ–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    MK->>A: –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ A/B –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    A-->>UI: –û—Ç—á–µ—Ç —Å –≤—ã–≤–æ–¥–∞–º–∏
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∏ –ø—Ä–æ–≤–æ–¥—è—Ç A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∞–∫—Ü–∏–π. –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 9: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ñ–ª–∞–π–Ω-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant W as –°–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    participant DB as PostgreSQL
    participant E as Event Bus
    participant L as Local SQLite

    M->>L: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ
    L-->>M: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    alt –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
        M->>A: POST /sync-workout
        A->>W: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö
        W->>DB: INSERT INTO workouts
        W->>E: WorkoutCompleted
    end
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 10: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```mermaid
sequenceDiagram
    participant M as –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    participant A as Internal API Gateway
    participant AI as AI Engine
    participant F as Feature Store
    participant E as Event Bus

    M->>A: GET /forecast
    A->>AI: –ó–∞–ø—Ä–æ—Å –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    AI->>F: –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    F-->>AI: –§–∏—á–∏
    AI->>AI: –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
    AI-->>M: –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```

### –û–ø–∏—Å–∞–Ω–∏–µ:
AI Engine –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥—É—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
