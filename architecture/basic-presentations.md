# –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## 1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å] -->|auth| B[–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏]
    A -->|profile| C[–°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è]
    A -->|roles| D[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
    A -->|consent| E[–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å]

    B -->|metrics| F[–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫]
    B -->|events| G[AI Engine]

    C -->|activity feed| F
    C -->|achievements| H[–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]

    D -->|personalization| B
    D -->|promotions| I[–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞]

    G -->|models| D
    G -->|predictive| J[–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–≤–º]

    H -->|push/email| K[Push Service]
    H -->|in-app| L[Redis Cache]

    I -->|A/B testing| M[CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å—è—Ç –ø–æ—á—Ç–∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.
- **CQRS** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö** –∏ **–∞–Ω–∞–ª–∏—Ç–∏–∫–µ**: –∑–∞–ø–∏—Å—å –∏–¥—ë—Ç —á–µ—Ä–µ–∑ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –ë–î, —á—Ç–µ–Ω–∏–µ ‚Äî —á–µ—Ä–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é/–∫–æ–ª–æ–Ω–æ—á–Ω—É—é.
- **Event Sourcing** –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `UserRegistered`, `WorkoutCompleted`).
- **AI Engine** –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É.

---

## 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

```mermaid
erDiagram
    USER ||--o{ WORKOUT : "has"
    USER ||--o{ ACHIEVEMENT : "unlocked"
    USER ||--o{ NOTIFICATION_PREFERENCE : "configures"
    USER ||--o{ RECOMMENDATION : "receives"

    WORKOUT ||--o{ SENSOR_DATA : "contains"
    WORKOUT }|--|| SPORT_TYPE : "is of type"

    GROUP ||--o{ USER_GROUP : "contains"
    GROUP }|--|| SPORT_TYPE : "for sport"

    LEADERBOARD ||--o{ USER_LEADERBOARD : "contains"

    PROMOTION ||--o{ USER_PROMOTION : "assigned to user"

    USER ||--o{ MARKETING_METRIC : "participates in campaigns"

    RECOMMENDATION }|--|| MODEL_VERSION : "generated by"
```

### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **PostgreSQL** (ACID, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏), –≤–∫–ª—é—á–∞—è –ø—Ä–æ—Ñ–∏–ª—å, —Å–µ—Å—Å–∏–∏, —Ä–æ–ª–∏.
- **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **PostgreSQL (–∑–∞–ø–∏—Å—å)** –∏ **MongoDB (—á—Ç–µ–Ω–∏–µ)** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ CQRS.
- **–õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã** ‚Äî –≤ **ClickHouse** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π.
- **–°–æ–±—ã—Ç–∏—è –∏ –ª–æ–≥–∏** ‚Äî –≤ **Apache Kafka** –¥–ª—è event sourcing –∏ replay.
- **AI –º–æ–¥–µ–ª–∏ –∏ —Ñ–∏—á–∏** ‚Äî –≤ **S3 + Delta Lake** –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—É—á–µ–Ω–∏—è.

---

## 3. –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å / Concurrency

```mermaid
sequenceDiagram
    participant U as User
    participant API as API Gateway
    participant WS as Workout Service
    participant AS as Analytics Service
    participant AE as AI Engine
    participant EB as Event Bus
    participant DB as PostgreSQL
    participant CH as ClickHouse

    U->>API: –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
    API->>WS: –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
    WS->>DB: INSERT INTO workouts
    DB-->>WS: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    WS->>EB: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è WorkoutStarted
    EB->>AS: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤
    EB->>AE: –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    AE->>AE: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
    AE->>EB: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã
    EB->>WS: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    WS-->>U: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **event-driven –ø–æ–¥—Ö–æ–¥** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- **Kafka** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π –¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ.
- **Redis** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Ä–µ–π—Ç–∏–Ω–≥–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).
- **Async processing** –¥–ª—è AI-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

---

## 4. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

```mermaid
graph LR
    subgraph Cloud Provider
        subgraph DMZ
            ext_api[(External API GW)]
            cdn[(CDN - SPA)]
            push_svc[(Push Service)]
        end

        subgraph Internal Network
            int_api[(Internal API GW)]
            k8s[(Kubernetes Cluster)]
            db[(PostgreSQL Cluster)]
            mongo[(MongoDB Atlas)]
            clickhouse[(ClickHouse Cluster)]
            redis[(Redis Cluster)]
            s3[(S3 Bucket)]
        end

        subgraph Data Layer
            kafka[(Kafka Cluster)]
            ai_engine[(AI Engine)]
            mlflow[(MLflow Tracking)]
        end

        subgraph Monitoring
            otel[(OpenTelemetry)]
            grafana[(Grafana)]
            elk[(ELK Stack)]
        end

        ext_api <-->|HTTPS| cdn & push_svc
        ext_api --> int_api
        int_api -->|gRPC| k8s
        k8s -->|SQL| db
        k8s -->|NoSQL| mongo
        k8s -->|Col| clickhouse
        k8s -->|Cache| redis
        k8s -->|Events| kafka
        k8s -->|Data| s3
        k8s -->|Models| mlflow

        kafka -->|Stream| ai_engine
        ai_engine -->|Store| s3
        ai_engine -->|Log| mlflow

        otel -->|Metrics| all_services
        elk -->|Logs| all_services
        grafana -->|Visualization| otel & elk
    end
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã + serverless –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á (AI-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞).
- **Multi-cloud —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**: Primary DC + Secondary (–≥–æ—Ä—è—á–∏–π) + Tertiary (—Ö–æ–ª–æ–¥–Ω—ã–π).
- **Infrastructure-as-Code**: Terraform + Helm –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ.
- **CI/CD**: GitLab CI —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–±–æ—Ä–∫–æ–π, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –¥–µ–ø–ª–æ–µ–º.
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker + Kubernetes –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```mermaid
graph TD
    A[–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ] -->|TLS 1.3| B[External API Gateway]
    B -->|mTLS| C[Internal API Gateway]
    C -->|RBAC| D[–°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π]
    C -->|JWT| E[–°–µ—Ä–≤–∏—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫]
    C -->|ACL| F[–°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏]

    G[SIEM] -->|Audit Logs| H[(ELK Stack)]
    I[Firewall] -->|DDoS Protection| B
    J[Consent Management] -->|GDPR| K[Database Encryption]
    L[Feature Store] -->|Anonymized Data| M[AI Training]
    N[Session Store] -->|Encrypted Redis| O[Token Revocation List]
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **DMZ** —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞: API Gateway, CDN, Push Service.
- –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ—Ä—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ **mutual TLS (mTLS)** –∏ **JWT**.
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: TLS 1.3 –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏, AES-256 –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è PII.
- **GDPR/CCPA Compliance**: –ø–æ–ª–∏—Ç–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, consent management.
- **SIEM-—Å–∏—Å—Ç–µ–º–∞** –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ DMZ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π.
- **AI-–º–æ–¥–µ–ª–∏** –æ–±—É—á–∞—é—Ç—Å—è –Ω–∞ **–∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏.
- **–°–µ—Å—Å–∏–∏** –∏ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º Redis.
