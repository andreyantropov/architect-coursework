# Критические бизнес-сценарии

## 1. Пользователь не может войти в систему
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Авторизации
    
    Пользователь->>API_Gateway: Отправить запрос на вход
    API_Gateway->>Сервис_Авторизации: Перенаправить запрос
    Сервис_Авторизации-->>API_Gateway: Ошибка входа
    API_Gateway-->>Пользователь: Получена ошибка авторизации
```

## 2. Пользователь не может начать тренировку
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Тренировок
    
    Пользователь->>API_Gateway: Запрос на тренировку
    API_Gateway->>Сервис_Тренировок: Перенаправить запрос
    Сервис_Тренировок-->>API_Gateway: Сервис недоступен
    API_Gateway-->>Пользователь: Ошибка начала тренировки
```

## 3. Лидерборды не обновляются
```mermaid
sequenceDiagram
    participant Сервис_Тренировок
    participant Event_Bus
    participant Сервис_Аналитики
    participant Пользователь
    
    Сервис_Тренировок->>Event_Bus: Данные о тренировке
    Event_Bus->>Сервис_Аналитики: Перенаправить данные
    Сервис_Аналитики-->>Event_Bus: Сервис недоступен
    Пользователь->>Пользователь: Открыть лидерборд (данные не обновлены)
```

## 4. Регистрация нового пользователя
```mermaid
flowchart TD
    A[Пользователь: Запрос на регистрацию] --> B[API Gateway]
    B --> C[Сервис Пользователи]
    C --> D{Email занят?}
    D -->|Да| E[Вернуть ошибку]
    E --> F[Пользователь получает ошибку]
    D -->|Нет| G[Создать пользователя]
    G --> H[Отправить письмо через SMTP]
    H --> I[Пользователь подтверждает email]
```

## 5. Интеграция с фитнес-устройством
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Тренировок
    participant API_Устройства
    
    Пользователь->>API_Gateway: Запрос на подключение
    API_Gateway->>Сервис_Тренировок: Перенаправить
    Сервис_Тренировок->>API_Устройства: Запрос авторизации
    API_Устройства-->>Пользователь: Подтвердить доступ
    Пользователь->>Сервис_Тренировок: Подтверждение
    Сервис_Тренировок->>Сервис_Тренировок: Сохранить токен
    par
        Сервис_Тренировок->>Сервис_Тренировок: Сбор данных
    and
        Сервис_Тренировок->>Пользователь: Данные в реальном времени
    end
```

## 6. Создание групповой тренировки
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Социализации
    participant Event_Bus
    participant Сервис_Уведомлений
    participant Участники
    
    Пользователь->>API_Gateway: Создать тренировку
    API_Gateway->>Сервис_Социализации: Перенаправить
    Сервис_Социализации->>Сервис_Социализации: Проверить права
    Сервис_Социализации->>Event_Bus: Событие создано
    Event_Bus->>Сервис_Уведомлений: Опубликовать
    Сервис_Уведомлений->>Участники: Разослать приглашения
```

## 7. Обработка промоакций
```mermaid
flowchart LR
    A[Администратор: Создать промо] --> B[Сервис Промоакций]
    B --> C[Сохранить в БД]
    C --> D[Event Bus]
    D --> E[Сервис Рекомендаций]
    E --> F[Персональные предложения]
    F --> G[Сервис Пользователей]
    G --> H[Фильтр по региону]
    H --> I[Пользователь получает промо]
    I --> J[Покупка со скидкой]
```

## 8. Восстановление пароля
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Пользователей
    participant SMTP_SMS
    
    Пользователь->>API_Gateway: Запрос восстановления
    API_Gateway->>Сервис_Пользователей: Перенаправить
    Сервис_Пользователей->>Сервис_Пользователей: Найти пользователя
    Сервис_Пользователей->>SMTP_SMS: Отправить ссылку
    SMTP_SMS-->>Пользователь: Письмо/SMS
    Пользователь->>Сервис_Пользователей: Перейти по ссылке
    Сервис_Пользователей->>Сервис_Пользователей: Обновить пароль
```

## 9. Синхронизация с соц. сетями
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Пользователей
    participant OAuth_Провайдер
    
    Пользователь->>API_Gateway: Запрос привязки
    API_Gateway->>Сервис_Пользователей: Перенаправить
    Сервис_Пользователей->>OAuth_Провайдер: Перенаправить
    OAuth_Провайдер-->>Пользователь: Запрос авторизации
    Пользователь->>OAuth_Провайдер: Подтвердить
    OAuth_Провайдер->>Сервис_Пользователей: Данные профиля
    Сервис_Пользователей->>Сервис_Социализации: Импорт друзей
```