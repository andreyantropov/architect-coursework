# Критические бизнес-сценарии

## 1. Пользователь не может войти в систему
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Авторизации
    
    Пользователь->>API_Gateway: Отправить запрос на вход
    API_Gateway->>Сервис_Авторизации: Перенаправить запрос
    Сервис_Авторизации-->>API_Gateway: Ошибка входа
    API_Gateway-->>Пользователь: "Ошибка авторизации"
```

## 2. Пользователь не может начать тренировку
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Тренировок
    
    Пользователь->>API_Gateway: Запрос на тренировку
    API_Gateway->>Сервис_Тренировок: Перенаправить запрос
    Сервис_Тренировок-->>API_Gateway: Сервис недоступен
    API_Gateway-->>Пользователь: "Ошибка начала тренировки"
```

## 3. Лидерборды не обновляются
```mermaid
sequenceDiagram
    participant Сервис_Тренировок
    participant Event_Bus
    participant Сервис_Аналитики
    participant Пользователь
    
    Сервис_Тренировок->>Event_Bus: Данные о тренировке
    Event_Bus->>Сервис_Аналитики: Перенаправить данные
    Сервис_Аналитики-->>Event_Bus: Сервис недоступен
    Пользователь->>Пользователь: Открыть лидерборд (данные не обновлены)
```

## 4. Регистрация нового пользователя
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Пользователей
    participant SMTP
    
    Пользователь->>API_Gateway: Запрос регистрации
    API_Gateway->>Сервис_Пользователей: Перенаправить
    Сервис_Пользователей->>Сервис_Пользователей: Проверка данных
    Сервис_Пользователей->>SMTP: Отправить письмо верификации
    SMTP-->>Сервис_Пользователей: Ошибка отправки
    Сервис_Пользователей-->>API_Gateway: Ошибка SMTP
    API_Gateway-->>Пользователь: "Не удалось отправить письмо"
```

## 5. Интеграция с фитнес-устройством 
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Тренировок
    participant API_Устройства
    
    Пользователь->>API_Gateway: Запрос подключения
    API_Gateway->>Сервис_Тренировок: Перенаправить
    Сервис_Тренировок->>API_Устройства: Запрос OAuth
    API_Устройства-->>Сервис_Тренировок: "Неверные credentials"
    Сервис_Тренировок-->>API_Gateway: Ошибка 403
    API_Gateway-->>Пользователь: "Доступ запрещен"
```

## 6. Создание групповой тренировки
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Социализации
    participant Сервис_Уведомлений
    
    Пользователь->>API_Gateway: Создать тренировку
    API_Gateway->>Сервис_Социализации: Перенаправить
    Сервис_Социализации->>Сервис_Уведомлений: Отправить приглашения
    Сервис_Уведомлений-->>Сервис_Социализации: Сервис недоступен
    Сервис_Социализации-->>API_Gateway: Ошибка
    API_Gateway-->>Пользователь: "Не удалось разослать приглашения"
```

## 7. Обработка промоакций
```mermaid
sequenceDiagram
    participant Администратор
    participant Сервис_Промо
    participant Сервис_Рекомендаций
    participant Сервис_Пользователей
    
    Администратор->>Сервис_Промо: Создать акцию
    Сервис_Промо->>Сервис_Рекомендаций: Запрос персонализации
    Сервис_Рекомендаций->>Сервис_Пользователей: Запрос данных
    Сервис_Пользователей-->>Сервис_Рекомендаций: Timeout
    Сервис_Рекомендаций-->>Сервис_Промо: Ошибка 504
    Сервис_Промо->>Администратор: "Не удалось обработать сегментацию"
```

## 8. Восстановление пароля
```mermaid
sequenceDiagram
    participant Пользователь
    participant API_Gateway
    participant Сервис_Пользователей
    
    Пользователь->>API_Gateway: Запрос сброса пароля
    API_Gateway->>Сервис_Пользователей: Перенаправить
    Сервис_Пользователей->>Пользователь: Timeout (вместо отправки SMS/SMTP)
    Пользователь->>API_Gateway: Ошибка 504
    API_Gateway-->>Пользователь: "Не удалось восстановить пароль. Попробуйте еще раз"
```